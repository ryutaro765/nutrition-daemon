// 魔城伝説のスプライトデータ抽出
// main.js.backupから抽出したスプライトデータとdrawSprite関数

const spriteData = {
    // ポポロン（魔城伝説風の重厚な鎧戦士・後ろ姿・角付きヘルメット）
    popolon: [
        [0,0,0,17,17,4,4,4,4,4,4,17,17,0,0,0],
        [0,0,17,17,4,4,4,4,4,4,4,4,17,17,0,0],
        [0,17,4,4,4,4,4,4,4,4,4,4,4,4,17,0],
        [17,4,4,18,18,4,4,4,4,4,4,18,18,4,4,17],
        [4,2,2,2,2,2,2,2,2,2,2,2,2,2,2,4],
        [4,2,11,11,11,2,2,2,2,2,2,11,11,2,4],
        [4,2,2,11,2,2,2,2,2,2,2,2,11,2,2,4],
        [4,2,2,2,2,2,14,14,14,14,2,2,2,2,2,4],
        [0,4,2,2,2,14,14,14,14,14,14,2,2,2,4,0],
        [0,4,4,2,2,14,14,19,19,14,14,2,2,4,4,0],
        [0,0,4,4,4,14,14,14,14,14,14,4,4,4,0,0],
        [0,0,4,4,14,14,19,0,0,19,14,14,4,4,0,0],
        [0,4,4,4,14,14,0,0,0,0,14,14,4,4,4,0],
        [4,4,4,4,4,4,0,0,0,0,4,4,4,4,4,4],
        [4,4,4,4,4,0,0,0,0,0,0,4,4,4,4,4],
        [4,4,4,4,0,0,0,0,0,0,0,0,4,4,4,4]
    ],
    // 高速モード用ポポロン（赤い重厚鎧戦士・後ろ姿・角付きヘルメット）
    popolon_speed: [
        [0,0,0,17,17,4,4,4,4,4,4,17,17,0,0,0],
        [0,0,17,17,4,4,4,4,4,4,4,4,17,17,0,0],
        [0,17,4,4,4,4,4,4,4,4,4,4,4,4,17,0],
        [17,4,4,18,18,4,4,4,4,4,4,18,18,4,4,17],
        [4,3,3,3,3,3,3,3,3,3,3,3,3,3,3,4],
        [4,3,15,15,15,3,3,3,3,3,3,15,15,3,4],
        [4,3,3,15,3,3,3,3,3,3,3,3,15,3,3,4],
        [4,3,3,3,3,3,16,16,16,16,3,3,3,3,3,4],
        [0,4,3,3,3,16,16,16,16,16,16,3,3,3,4,0],
        [0,4,4,3,3,16,16,20,20,16,16,3,3,4,4,0],
        [0,0,4,4,4,16,16,16,16,16,16,4,4,4,0,0],
        [0,0,4,4,16,16,20,0,0,20,16,16,4,4,0,0],
        [0,4,4,4,16,16,0,0,0,0,16,16,4,4,4,0],
        [4,4,4,4,4,4,0,0,0,0,4,4,4,4,4,4],
        [4,4,4,4,4,0,0,0,0,0,0,4,4,4,4,4],
        [4,4,4,4,0,0,0,0,0,0,0,0,4,4,4,4]
    ],
    // コウモリ - 黒い体、赤い目
    bat: [
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,1,1,0,0,0,0,0,0,0,0,0,0,1,1,0],
        [1,1,1,1,0,0,0,0,0,0,0,0,1,1,1,1],
        [1,1,1,1,1,0,0,0,0,0,0,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
        [0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],
        [0,0,1,1,1,1,1,1,1,1,1,1,1,1,0,0],
        [0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0],
        [0,0,0,0,1,3,1,1,1,1,3,1,0,0,0,0],
        [0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0],
        [0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
    ],
    // ？ボックス - 灰色ブロックに黒文字の？
    questionBox: [
        [8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8],
        [8,12,12,12,12,12,12,12,12,12,12,12,12,12,12,8],
        [8,12,12,12,12,12,12,12,12,12,12,12,12,12,12,8],
        [8,12,12,0,0,0,0,0,0,0,0,0,0,12,12,8],
        [8,12,12,0,12,12,12,12,12,12,12,0,0,12,12,8],
        [8,12,12,0,12,12,12,12,12,12,12,0,0,12,12,8],
        [8,12,12,0,0,0,0,0,0,12,12,0,0,12,12,8],
        [8,12,12,0,0,0,0,12,12,12,12,0,0,12,12,8],
        [8,12,12,0,0,0,12,12,12,0,0,0,0,12,12,8],
        [8,12,12,0,0,0,12,12,0,0,0,0,0,12,12,8],
        [8,12,12,0,0,0,0,0,0,0,0,0,0,12,12,8],
        [8,12,12,0,0,0,12,12,12,0,0,0,0,12,12,8],
        [8,12,12,12,12,12,12,12,12,12,12,12,12,12,12,8],
        [8,12,12,12,12,12,12,12,12,12,12,12,12,12,12,8],
        [8,13,13,13,13,13,13,13,13,13,13,13,13,13,13,8],
        [8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8]
    ],
    // メデューサ（ボス）
    medusa: [
        [0,0,0,9,9,9,9,9,9,9,9,9,9,0,0,0],
        [0,9,9,9,9,9,9,9,9,9,9,9,9,9,9,0],
        [9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9],
        [9,9,5,5,9,9,9,9,9,9,9,9,5,5,9,9],
        [9,9,5,3,9,9,9,9,9,9,9,9,5,3,9,9],
        [9,9,9,9,9,9,5,5,5,5,9,9,9,9,9,9],
        [9,9,9,9,9,5,5,1,1,5,5,9,9,9,9,9],
        [10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10],
        [10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10],
        [10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10],
        [10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10],
        [0,10,10,10,10,10,10,10,10,10,10,10,10,10,10,0],
        [0,0,10,10,10,10,10,10,10,10,10,10,10,10,0,0],
        [0,0,0,10,10,10,10,10,10,10,10,10,10,0,0,0],
        [0,0,0,0,10,10,10,10,10,10,10,10,0,0,0,0],
        [0,0,0,0,0,10,10,10,10,10,10,0,0,0,0,0]
    ]
};

// カラーパレット
const colors = {
    0: '#000000', // 黒
    1: '#333333', // 濃いグレー（コウモリの体）
    2: '#4169E1', // 水色の鎧（ポポロンのメイン）
    3: '#FF0000', // 赤（目、高速モード）
    4: '#8B4513', // 茶色（ポポロンの髪・革）
    5: '#FFE4C4', // 肌色
    6: '#FFD700', // 金色（？ボックス外枠）
    7: '#FFA500', // オレンジ（？ボックス内側）
    8: '#696969', // ダークグレー（？ボックス外枠）
    9: '#228B22', // 緑（メデューサの髪・蛇）
    10: '#DC143C', // 深紅（メデューサの服）
    11: '#87CEEB',  // 明るい水色（鎧の装飾）
    12: '#C0C0C0', // ライトグレー（？ボックス内側）
    13: '#808080', // グレー（？ボックス影）
    14: '#1E90FF', // 鮮やかな青（鎧の中央部）
    15: '#FF6B6B', // 明るい赤（高速モード鎧装飾）
    16: '#FF1493', // 深いピンク（高速モード鎧中央）
    17: '#D2691E', // ブロンズ（ヘルメットの角）
    18: '#C0C0C0', // シルバー（ヘルメット装飾）
    19: '#FFD700', // ゴールド（鎧の装飾）
    20: '#FFA500'  // オレンジゴールド（高速モード装飾）
};

// ドット絵描画関数
function drawSprite(ctx, spriteKey, x, y, scale = 2) {
    try {
        const sprite = spriteData[spriteKey];
        if (!sprite || !Array.isArray(sprite)) return;
        
        for (let row = 0; row < sprite.length; row++) {
            if (!sprite[row] || !Array.isArray(sprite[row])) continue;
            for (let col = 0; col < sprite[row].length; col++) {
                const colorIndex = sprite[row][col];
                if (colorIndex !== 0 && colors[colorIndex]) { // 透明色以外かつ色が存在
                    ctx.fillStyle = colors[colorIndex];
                    ctx.fillRect(
                        x + col * scale, 
                        y + row * scale, 
                        scale, 
                        scale
                    );
                }
            }
        }
    } catch (e) {
        console.warn('Error drawing sprite:', spriteKey, e);
    }
}

// スプライト使用例（実際のゲームから抽出）:
/*
// ？ボックス描画（2.25倍サイズ）
drawSprite(ctx, 'questionBox', box.x, box.y, 2.25);

// ポポロン描画（通常時と高速モード時）
let spriteKey = gameState.isSpeedMode ? 'popolon_speed' : 'popolon';
drawSprite(ctx, spriteKey, player.x, player.y, 2.25);

// コウモリ描画（3倍サイズ）
drawSprite(ctx, 'bat', enemy.x, enemy.y, 3);

// メデューサ描画（16.875倍サイズ）
drawSprite(ctx, 'medusa', boss.x, boss.y, 16.875);
*/

// モジュールとしてエクスポート
if (typeof module !== 'undefined' && module.exports) {
    module.exports = {
        spriteData,
        colors,
        drawSprite
    };
}

// ブラウザ環境での使用
if (typeof window !== 'undefined') {
    window.spriteData = spriteData;
    window.spriteColors = colors;
    window.drawSprite = drawSprite;
}