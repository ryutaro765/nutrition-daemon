<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>È≠îÂüé‰ºùË™¨ - Demon Castle Legend</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üè∞</text></svg>">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: linear-gradient(45deg, #1a2e1a, #213e16);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: 'Courier New', monospace;
            color: white;
            overflow-x: auto;
        }
        
        .game-container {
            position: relative;
            border: 3px solid #00ff00;
            border-radius: 10px;
            box-shadow: 0 0 20px #00ff00;
            background: #000;
            margin-bottom: 20px;
        }
        
        #gameCanvas {
            display: block;
            background: linear-gradient(180deg, #87CEEB, #228B22);
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
            max-width: 100%;
            height: auto;
            position: relative;
            z-index: 0;
        }
        
        .controls {
            text-align: center;
            color: #aaa;
            font-size: 14px;
            max-width: 800px;
            line-height: 1.6;
        }
        
        .controls h3 {
            color: #00ff00;
            margin: 20px 0 10px 0;
        }
        
        .control-group {
            display: inline-block;
            margin: 0 20px 10px 0;
            text-align: left;
            vertical-align: top;
        }
        
        .key {
            display: inline-block;
            background: #333;
            color: #fff;
            padding: 2px 6px;
            border-radius: 3px;
            font-weight: bold;
            margin-right: 5px;
        }
        
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            color: #00ff00;
            font-size: 18px;
            display: none;
        }
        
        .error {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            color: #ff6b6b;
            font-size: 18px;
            display: none;
            background: rgba(0, 0, 0, 0.8);
            padding: 20px;
            border-radius: 10px;
        }

        @media (max-width: 850px) {
            body {
                padding: 10px;
            }
            
            .controls {
                font-size: 12px;
            }
            
            .control-group {
                display: block;
                margin: 5px 0;
            }
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .pulse {
            animation: pulse 1s infinite;
        }
        
        /* „É¨„Éà„É≠„Å™„Çπ„Ç≠„É£„É≥„É©„Ç§„É≥ÂäπÊûú */
        .game-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(
                transparent 50%,
                rgba(0, 255, 0, 0.03) 50%
            );
            background-size: 100% 4px;
            pointer-events: none;
            z-index: 10;
        }
        
        /* CRT„É¢„Éã„Çø„ÉºÂäπÊûú */
        .game-container::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(ellipse at center, transparent 70%, rgba(0,0,0,0.2) 100%);
            pointer-events: none;
            z-index: 11;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <canvas id="gameCanvas" width="800" height="600"></canvas>
        
        <div class="loading" id="loadingScreen">
            <div class="pulse">Loading Game...</div>
            <div style="font-size: 14px; margin-top: 10px;">
                Initializing audio system and game modules
            </div>
        </div>
        
        <div class="error" id="errorScreen">
            <div style="font-size: 24px; margin-bottom: 10px;">‚ö†Ô∏è Error</div>
            <div id="errorMessage">Failed to load the game.</div>
            <div style="font-size: 14px; margin-top: 10px;">
                Please check your browser compatibility and reload the page.
            </div>
        </div>
    </div>
    
    <div class="controls">
        <h3>üéÆ Controls</h3>
        
        <div class="control-group">
            <strong>Movement:</strong><br>
            <span class="key">W</span><span class="key">A</span><span class="key">S</span><span class="key">D</span> or Arrow Keys
        </div>
        
        <div class="control-group">
            <strong>Actions:</strong><br>
            <span class="key">SPACE</span> Shoot / Select<br>
            <span class="key">P</span> Pause<br>
            <span class="key">R</span> Restart<br>
            <span class="key">ESC</span> Menu / Back
        </div>
        
        <div class="control-group">
            <strong>Special:</strong><br>
            <span class="key">SHIFT</span> Special Attack<br>
            <span class="key">C</span> Continue (when available)
        </div>
        
        <h3>üéØ Game Features</h3>
        <div style="text-align: left; display: inline-block;">
            ‚Ä¢ <strong>9-Level Weapon System</strong> - Upgrade your arsenal<br>
            ‚Ä¢ <strong>3 Unique Bosses</strong> - Face the Demon Lords<br>
            ‚Ä¢ <strong>Procedural Music</strong> - Dynamic Tone.js soundtrack<br>
            ‚Ä¢ <strong>Pixel Art Graphics</strong> - Retro 16x16 sprites<br>
            ‚Ä¢ <strong>Particle Effects</strong> - Explosions, sparks, and trails<br>
            ‚Ä¢ <strong>Power-up System</strong> - Health, weapons, and special items<br>
            ‚Ä¢ <strong>Continue System</strong> - Second chances to complete your quest<br>
            ‚Ä¢ <strong>Speed Mode</strong> - Temporary power boost
        </div>
        
        <h3>üéµ Audio</h3>
        <div style="text-align: left; display: inline-block;">
            ‚Ä¢ Click anywhere to enable audio<br>
            ‚Ä¢ Procedural BGM adapts to gameplay<br>
            ‚Ä¢ Dynamic sound effects for all actions<br>
            ‚Ä¢ Volume controls in settings menu
        </div>
        
        <h3>üè∞ Story</h3>
        <div style="text-align: left; display: inline-block; max-width: 600px;">
            Long ago, the Demon Castle appeared, spreading darkness across the land. 
            Heroes fell one by one to its terrible power. Armed with ancient weapons 
            and unwavering courage, you must storm the castle and defeat the Demon Lords!
        </div>
        
        <div style="margin-top: 20px; font-size: 12px; color: #666;">
            Built with ES6 Modules ‚Ä¢ HTML5 Canvas ‚Ä¢ Tone.js Audio ‚Ä¢ Vite Build System<br>
            ¬© 2024 Magic Castle Studios | Powered by Claude AI
        </div>
    </div>

    <!-- Game Scripts -->
    <script type="module" src="./src/main.js"></script>
    
    <script>
        // „Ç®„É©„Éº„Éè„É≥„Éâ„É™„É≥„Ç∞
        window.addEventListener('error', (event) => {
            console.error('Script error:', event.error);
            document.getElementById('loadingScreen').style.display = 'none';
            document.getElementById('errorScreen').style.display = 'block';
            document.getElementById('errorMessage').textContent = 
                event.error?.message || 'Failed to load game modules.';
        });
        
        // „É≠„Éº„ÉâÂÆå‰∫ÜÂæå„ÅÆÂá¶ÁêÜ
        window.addEventListener('load', () => {
            setTimeout(() => {
                document.getElementById('loadingScreen').style.display = 'none';
            }, 2000);
        });
        
        // „Ç™„Éº„Éá„Ç£„Ç™ÊúâÂäπÂåñÔºà„ÇØ„É™„ÉÉ„ÇØ„Éª„Çø„ÉÉ„ÉÅÂØæÂøúÔºâÔºà‰øÆÊ≠£ÁâàÔºâ
        const enableAudio = () => {
            console.log('üîä HTML: User interaction detected, enabling audio...');
            
            // Tone.js„ÅÆÁõ¥Êé•Á¢∫Ë™ç
            if (window.Tone) {
                console.log('üîä HTML: Tone.js available, context state:', window.Tone.context.state);
            } else {
                console.error('‚ùå HTML: Tone.js not available!');
            }
            
            if (window.game && window.game.audioManager) {
                console.log('üîä HTML: Game and AudioManager found, initializing...');
                window.game.audioManager.initializeAfterUserInteraction()
                    .then(success => {
                        console.log('üîä HTML: Audio initialization result:', success);
                        if (success) {
                            console.log('‚úÖ HTML: Audio system is now ready');
                            // Á∞°Âçò„Å™Èü≥Èüø„ÉÜ„Çπ„Éà
                            setTimeout(() => {
                                console.log('üéµ HTML: Testing audio system...');
                                window.game.audioManager.playSFX('menuSelect');
                            }, 500);
                        } else {
                            console.warn('‚ö†Ô∏è HTML: Audio initialization failed');
                        }
                    })
                    .catch(error => {
                        console.error('‚ùå HTML: Audio initialization failed:', error);
                    });
            } else {
                console.warn('‚ö†Ô∏è HTML: Game or AudioManager not available yet');
                // Â∞ë„ÅóÂæÖ„Å£„Å¶ÂÜçË©¶Ë°å
                setTimeout(() => {
                    if (window.game && window.game.audioManager) {
                        console.log('üîä HTML: Retrying audio initialization...');
                        window.game.audioManager.initializeAfterUserInteraction()
                            .then(success => {
                                if (success) {
                                    // „ÉÜ„Çπ„ÉàÈü≥„ÅÆÂÜçÁîü
                                    setTimeout(() => {
                                        console.log('üéµ HTML: Testing audio after retry...');
                                        window.game.audioManager.playSFX('menuSelect');
                                    }, 500);
                                }
                            });
                    }
                }, 1000);
            }
        };
        
        document.addEventListener('click', enableAudio, { once: true });
        document.addEventListener('touchstart', enableAudio, { once: true });
        document.addEventListener('keydown', enableAudio, { once: true });
        
        // „Éá„Éê„ÉÉ„Ç∞ÊÉÖÂ†±Ë°®Á§∫ÔºàÈñãÁô∫ÊôÇ„ÅÆ„ÅøÔºâ
        if (localStorage.getItem('debug') === 'true') {
            window.addEventListener('keydown', (event) => {
                if (event.key === 'F12' || (event.ctrlKey && event.shiftKey && event.key === 'I')) {
                    if (window.game) {
                        console.log('Debug Info:', window.game.getDebugInfo());
                    }
                }
            });
        }
        
        // „Éë„Éï„Ç©„Éº„Éû„É≥„ÇπÁõ£Ë¶ñ
        let frameCount = 0;
        let lastFPSCheck = performance.now();
        
        function checkFPS() {
            frameCount++;
            const now = performance.now();
            
            if (now - lastFPSCheck >= 1000) {
                const fps = Math.round((frameCount * 1000) / (now - lastFPSCheck));
                
                if (fps < 30) {
                    console.warn(`Low FPS detected: ${fps}`);
                }
                
                frameCount = 0;
                lastFPSCheck = now;
            }
            
            requestAnimationFrame(checkFPS);
        }
        
        // FPSÁõ£Ë¶ñÈñãÂßã
        requestAnimationFrame(checkFPS);
    </script>
</body>
</html>